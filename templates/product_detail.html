{% extends "base.html" %} {% block title %}{{ product.name }} - Codexia{%
endblock %} {% block content %}
<div class="row">
  <!-- Görseller Carousel -->
  <div class="col-md-6">
    <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
      <div class="carousel-inner">
        {% if product.image_url %}
        <div class="carousel-item active">
          <img
            src="{{ product.image_url }}"
            class="d-block w-100 rounded shadow-sm"
            alt="{{ product.name }}"
          />
        </div>
        {% endif %} {% if product.extra_images %} {% for img in
        product.extra_images %}
        <div
          class="carousel-item {% if not product.image_url and loop.first %}active{% endif %}"
        >
          <img
            src="{{ img }}"
            class="d-block w-100 rounded shadow-sm"
            alt="{{ product.name }}"
          />
        </div>
        {% endfor %} {% endif %}
      </div>
      <button
        class="carousel-control-prev"
        type="button"
        data-bs-target="#productCarousel"
        data-bs-slide="prev"
      >
        <span class="carousel-control-prev-icon"></span>
      </button>
      <button
        class="carousel-control-next"
        type="button"
        data-bs-target="#productCarousel"
        data-bs-slide="next"
      >
        <span class="carousel-control-next-icon"></span>
      </button>
    </div>
  </div>

  <!-- Ürün Bilgileri -->
  <div class="col-md-6">
    <h2 class="text-primary">{{ product.name }}</h2>
    {% if product.brand %}
    <p class="text-muted">{{ product.brand }}</p>
    {% endif %} {% if product.effective_discount > 0 %}
    <p>
      <span class="text-danger fw-bold">
        {{ product.effective_discount }}% İndirim! {% if product.campaign %} ({{
        product.campaign.title }}) {% endif %} </span
      ><br />
      <del>{{ "%.2f"|format(product.price) }} TL</del><br />
      <span class="fs-4 fw-bold text-success">
        {{ "%.2f"|format(product.discounted_price) }} TL
      </span>
    </p>
    {% else %}
    <p class="fs-4 fw-bold">{{ "%.2f"|format(product.price) }} TL</p>
    {% endif %}

    <p>
      <strong>Stok:</strong>
      {% if product.stock > 0 %}
      <span class="text-success">{{ product.stock }} adet mevcut</span>
      {% else %}
      <span class="text-danger">Stokta yok</span>
      {% endif %}
    </p>

    {% if product.is_active %}
    <!-- Sepete ekleme formu -->
    <form
      method="POST"
      action="{{ url_for('product_detail', pid=product.id) }}"
      class="mt-3"
    >
      {{ form.hidden_tag() }}
      <div class="mb-3">
        {{ form.quantity.label(class="form-label fw-bold") }} {{
        form.quantity(class="form-control", value=1) }}
      </div>
      <button type="submit" class="btn btn-warning">
        <i class="fas fa-cart-plus me-1"></i> Sepete Ekle
      </button>
    </form>

    <!-- Favorilere ekleme -->
    {% if current_user.is_authenticated %}
    <form
      method="POST"
      action="{{ url_for('wishlist_add', pid=product.id) }}"
      class="mt-2"
    >
      {{ form.hidden_tag() }}
      <button type="submit" class="btn btn-outline-danger w-100">
        <i class="fas fa-heart me-1"></i> Favorilere Ekle
      </button>
    </form>
    {% endif %} {% else %}
    <p class="text-danger fw-bold">Bu ürün şu anda yayında değil.</p>
    {% endif %}
  </div>
</div>

<hr />

<!-- Accordion -->
<div class="accordion mt-4" id="productAccordion">
  <!-- Açıklama -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingDesc">
      <button
        class="accordion-button"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#collapseDesc"
      >
        Ürün Açıklaması – İncele
      </button>
    </h2>
    <div
      id="collapseDesc"
      class="accordion-collapse collapse show"
      data-bs-parent="#productAccordion"
    >
      <div class="accordion-body">
        {{ product.description or 'Açıklama bulunmamaktadır.' }}
      </div>
    </div>
  </div>

  <!-- Teknik Özellikler -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingSpecs">
      <button
        class="accordion-button collapsed"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#collapseSpecs"
      >
        Teknik Özellikler – İncele
      </button>
    </h2>
    <div
      id="collapseSpecs"
      class="accordion-collapse collapse"
      data-bs-parent="#productAccordion"
    >
      <div class="accordion-body">
        <ul class="list-unstyled">
          {% if product.shipping_info %}
          <li><strong>Kargo:</strong> {{ product.shipping_info }}</li>
          {% endif %} {% if product.weight %}
          <li><strong>Ağırlık:</strong> {{ product.weight }} kg</li>
          {% endif %} {% if product.dimensions %}
          <li><strong>Boyutlar:</strong> {{ product.dimensions }}</li>
          {% endif %} {% if product.warranty %}
          <li><strong>Garanti:</strong> {{ product.warranty }}</li>
          {% endif %} {% if product.supplier %}
          <li><strong>Tedarikçi:</strong> {{ product.supplier }}</li>
          {% endif %} {% if product.tags %}
          <li><strong>Etiketler:</strong> {{ product.tags }}</li>
          {% endif %} {% if product.features %}
          <li><strong>Özellikler:</strong> {{ product.features }}</li>
          {% endif %} {% if product.variants %}
          <li><strong>Varyantlar:</strong> {{ product.variants }}</li>
          {% endif %}
        </ul>
      </div>
    </div>
  </div>

  <!-- Kampanya Bilgisi -->
  {% if product.campaign %}
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingCampaign">
      <button
        class="accordion-button collapsed"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#collapseCampaign"
      >
        Kampanya Bilgisi – İncele
      </button>
    </h2>
    <div
      id="collapseCampaign"
      class="accordion-collapse collapse"
      data-bs-parent="#productAccordion"
    >
      <div class="accordion-body">
        <strong>{{ product.campaign.title }}</strong><br />
        {{ product.campaign.description }}<br />
        <span class="badge bg-info"
          >İndirim: %{{ product.campaign.discount }}</span
        >
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Yorumlar -->
  <div class="accordion-item">
    <h2 class="accordion-header" id="headingReviews">
      <button
        class="accordion-button collapsed"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#collapseReviews"
      >
        Yorumlar & Değerlendirmeler – İncele
      </button>
    </h2>
    <div
      id="collapseReviews"
      class="accordion-collapse collapse"
      data-bs-parent="#productAccordion"
    >
      <div class="accordion-body">
        <p class="mb-3">
          <strong>Puan:</strong> {{ product.rating }}/5 ({{ product.review_count
          }} değerlendirme)
        </p>
        {% if reviews and reviews|length > 0 %} {% for review in reviews %}
        <div class="border-bottom mb-3 pb-2">
          <div class="d-flex justify-content-between align-items-center">
            <strong>{{ review.user.fullname }}</strong>
            <span class="text-warning">★ {{ review.rating }}</span>
          </div>
          <small class="text-muted"
            >{{ review.created_at.strftime('%d.%m.%Y %H:%M') }}</small
          >
          <p class="mt-2 mb-0">{{ review.comment }}</p>
        </div>
        {% endfor %} {% else %}
        <p>Henüz yorum yapılmamış.</p>
        {% endif %} {% if current_user.is_authenticated %}
        <form method="POST" class="mt-3">
          {{ review_form.hidden_tag() }}
          <div class="mb-3">
            {{ review_form.rating.label(class="form-label fw-bold") }} {{
            review_form.rating(class="form-control", placeholder="1-5") }}
          </div>
          <div class="mb-3">
            {{ review_form.comment.label(class="form-label fw-bold") }} {{
            review_form.comment(class="form-control", rows="3",
            placeholder="Ürüne dair deneyiminizi yazın") }}
          </div>
          <button type="submit" class="btn btn-primary">Yorum Gönder</button>
        </form>
        {% else %}
        <p class="text-muted">
          Yorum yapmak için <a href="{{ url_for('login') }}">giriş yapın</a>.
        </p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Benzer Ürünler -->
<hr />
<h4 class="mt-4">Benzer Ürünler</h4>
<div class="row">
  {% for r in related_products %}
  <div class="col-6 col-md-3 mb-3">
    <div class="card h-100 shadow-sm">
      <img
        src="{{ r.image_url or '/static/img/no-image.png' }}"
        class="card-img-top"
        alt="{{ r.name }}"
        style="object-fit: cover; height: 180px"
      />
      <div class="card-body d-flex flex-column">
        <h6 class="card-title fw-bold">{{ r.name }}</h6>

        {% if r.effective_discount > 0 %}
        <p class="mb-2">
          <span class="text-danger fw-bold"
            >{{ r.effective_discount }}% İndirim!</span
          ><br />
          <del class="text-muted">{{ "%.2f"|format(r.price) }} TL</del><br />
          <span class="text-success fw-bold"
            >{{ "%.2f"|format(r.discounted_price) }} TL</span
          >
          {% if r.campaign %}
          <br /><small class="badge bg-info">{{ r.campaign.title }}</small>
          {% endif %}
        </p>
        {% else %}
        <p class="text-muted mb-2">{{ "%.2f"|format(r.price) }} TL</p>
        {% endif %}

        <a
          href="{{ url_for('product_detail', pid=r.id) }}"
          class="btn btn-outline-primary btn-sm mt-auto"
        >
          İncele
        </a>
      </div>
    </div>
  </div>
  {% else %}
  <p class="text-muted">Benzer ürün bulunamadı.</p>
  {% endfor %}
</div>
{% endblock %}
