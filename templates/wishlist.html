{% extends "base.html" %} {% block title %}Favorilerim - Codexia{% endblock %}
{% block content %}
<h2 class="mb-4 text-danger"><i class="fas fa-heart me-2"></i> Favorilerim</h2>

{% if wishlist_items and wishlist_items|length > 0 %}
<div class="row">
  {% for product in wishlist_items %}
  <div class="col-6 col-md-4 col-lg-3 mb-4">
    <div class="card shadow-sm h-100">
      <!-- Ürün görseli -->
      <img
        src="{{ url_for('static', filename=product.image_url) if product.image_url else url_for('static', filename='img/no-image.png') }}"
        class="card-img-top"
        alt="{{ product.name }}"
        style="object-fit: cover; height: 200px"
      />

      <div class="card-body d-flex flex-column">
        <h6 class="card-title fw-bold">{{ product.name }}</h6>

        <!-- Fiyat ve indirim -->
        {% if product.discount and product.discount > 0 %}
        <p class="mb-1">
          <span class="text-danger fw-bold">
            {{ (product.price - (product.price * product.discount /
            100))|round(2) }} TL
          </span>
          <span class="text-muted text-decoration-line-through small">
            {{ product.price }} TL
          </span>
        </p>
        <span class="badge bg-success mb-2">-{{ product.discount }}%</span>
        {% else %}
        <p class="text-muted mb-2">{{ product.price }} TL</p>
        {% endif %}

        <!-- İşlem butonları -->
        <div class="d-flex justify-content-between mt-auto">
          <a
            href="{{ url_for('product_detail', pid=product.id) }}"
            class="btn btn-primary btn-sm"
          >
            <i class="fas fa-eye"></i> İncele
          </a>

          <!-- Sepete ekleme formu POST olmalı -->
          <form
            method="POST"
            action="{{ url_for('cart_add', pid=product.id) }}"
          >
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <button type="submit" class="btn btn-success btn-sm">
              <i class="fas fa-shopping-cart"></i> Sepete Ekle
            </button>
          </form>
        </div>

        <!-- Favoriden kaldırma -->
        <form
          method="POST"
          action="{{ url_for('wishlist_remove', pid=product.id) }}"
          class="mt-2"
        >
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
          <button type="submit" class="btn btn-outline-secondary btn-sm w-100">
            <i class="fas fa-times"></i> Favoriden Kaldır
          </button>
        </form>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="alert alert-info">Henüz favori ürününüz bulunmamaktadır.</div>
{% endif %} {% endblock %}
